<!DOCTYPE html>
<html>

<head>
    <title>Macbook Configurator</title>
    <meta charset="utf-8">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #ui {
            position: absolute;
            top: 0;
            left: 0;
            height: 400px;
            width: 400px;
            background-color: rgba(0,0,0,0.7);
            color: white;
        }
        
        .ui .next {
            position: absolute;
            bottom: 1em;
            right: 1em;
        }
        
        .ui {
            display: none;
        }
        
        .ui.active {
            display: block;
        }
    </style>
</head>

<div id="webgl-container">
</div>
  
<div id="ui">
    <div class="ui active" id="ui_body">
        <h1>Configure Aluminium</h1>
        <input id="tf_body" type="text" placeholder="Aluminium Color" />
        
        <input id="body_next" class="next" type="button" value="next" />
    </div>
    
    <div class="ui" id="ui_trackpad">
        <h1>Configure Trackpad</h1>
        <input id="tf_trackpadColor" type="text" placeholder="Trackpad Color" />
        
        <input id="trackpad_next" class="next" type="button" value="next" />
    </div>
</div>

<body>
    <script type="text/javascript" src="js/three.js"></script>
    <script type="text/javascript" src="js/ColladaLoader.js"></script>
    <script type="text/javascript" src="js/OrbitControls.js"></script>
    <script type="text/javascript" src="MacBookConfigurator.js"></script>
    <script type="text/javascript" src="UI.js"></script>
    <script type="text/javascript">
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        var renderer = new THREE.WebGLRenderer();

        renderer.setClearColor(0xeeeeee, 1.0);
        renderer.setSize(window.innerWidth, window.innerHeight);
        var webglContainer = document.getElementById('webgl-container');
        webglContainer.appendChild(renderer.domElement);

        // window resize handler
        window.addEventListener('resize', onWindowResize, false);

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // camera controls
        var camControls = new THREE.OrbitControls(camera, renderer.domElement);
        camControls.damping = 0.2;
        camControls.addEventListener('change', render);
        
        var axes = new THREE.AxisHelper(20);
        var grid = new THREE.GridHelper(40, 1);

         // create the ground plane
        var planeGeometry = new THREE.PlaneGeometry(500, 500, 10, 10);
        var floorTexture = THREE.ImageUtils.loadTexture("assets/floor_wood_black.jpg" );
        floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
        floorTexture.repeat.set(8, 8);

        var planeMaterial = new THREE.MeshPhongMaterial({
            map: floorTexture
        });
        var plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -0.5 * Math.PI;
        plane.position.x = 0;
        plane.position.y = -30;
        plane.position.z = 0;
        scene.add(plane);

        var imagePrefix = "assets/images/dawnmountain-";
        var directions  = ["xpos", "xneg", "ypos", "yneg", "zpos", "zneg"];
        var imageSuffix = ".png";
        var skyGeometry = new THREE.BoxGeometry( 500, 500, 500 );    

        var materialArray = [];
        for (var i = 0; i < 6; i++){
            materialArray.push( new THREE.MeshPhongMaterial({
                map: THREE.ImageUtils.loadTexture( "assets/brick_texture3316.jpg" ),
                side: THREE.BackSide
            }));
        }
        var skyMaterial = new THREE.MeshFaceMaterial(materialArray);
        var skyBox = new THREE.Mesh(skyGeometry, skyMaterial);
        scene.add(skyBox);
        
        loader.load('assets/table.dae', function (collada) {
            var dae = collada.scene;
            dae.position.set(0, -1, 0); //x,z,y- if you think in blender dimensions ;)
            dae.scale.set(0.1, 0.1, 0.1);
            scene.add(dae);
            
            render();
        });

        // position and point the camera to the center of the scene
        camera.position.x = -35;
        camera.position.y = 40;
        camera.position.z = 60;
        camera.lookAt(scene.position);

        // add spotlight
        var spotLight = new THREE.SpotLight(0xf0f0f0);
        spotLight.position.set(800, 700, 900);
        scene.add(spotLight);

        var spotLight = new THREE.SpotLight(0xf0f0f0);
        spotLight.position.set(-800, -700, -900);
        scene.add(spotLight);

        // init and call render function
        function render() {
            renderer.render(scene, camera);
            //requestAnimationFrame(render);
        }
        initShadow(true);
        render();
        setShadow(false);

        // shadow cast on plane
        function initShadow(value) {
            // SET receiveShadow AND castShadow FLAGS OF 3D ELEMENTS WITH SHADOW
            plane.receiveShadow = value;
            spotLight.castShadow = value;
            renderer.shadowMapEnabled = value;
        }

        function setShadow(value) {
            if (value) {
                renderer.shadowMapAutoUpdate = true;
            } else {
                renderer.shadowMapAutoUpdate = false;
                renderer.clearTarget(spotLight.shadowMap);
            }
        }
    </script>
</body>

</html>